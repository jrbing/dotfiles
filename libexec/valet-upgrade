#!/usr/bin/env bash
# Usage: valet upgrade
# Summary: Upgrade installed software
# Help: Use this command to upgrade the installed software using the
# environments default package manager(s)

set -e

# Source generic bash functions
source "$DOTFILES/share/lib/bash-functions.sh"

case $(uname) in
  (Darwin)
    # Update homebrew (if installed) and upgrade packages
    if hash brew 2>/dev/null; then
      spininfo "Updating homebrew repo" "brew update > /dev/null 2>&1"
      echoinfo "Outdated packages" && brew outdated
      spininfo "Upgrading homebrew packages" "brew upgrade > /dev/null 2>&1"
      spininfo "Cleaning up homebrew" "brew cleanup > /dev/null 2>&1"
    fi
    #if hash pip > /dev/null 2>&1; then
      #spininfo "Updating pip packages" "pip freeze --local | grep -v '^\-e' | cut -d = -f 1  | xargs -n1 pip install -U > /dev/null 2>&1"
    #fi
  ;;
  (Linux)
    if hash yum 2>/dev/null; then
      echoinfo 'Updating packages'
      sudo yum upgrade -y
    fi
    if hash aptitude 2>/dev/null; then
      echoinfo 'Updating packages'
      sudo aptitude upgrade -y
    fi
  ;;
  (SunOS)
    echoinfo 'Updating packages'
    sudo pkgin update && sudo pkgin upgrade -y
  ;;
esac

exit 0
