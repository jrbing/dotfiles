#!/usr/bin/env bash
# Usage: valet upgrade
# Summary: Upgrade installed software
# Help: Use this command to upgrade the installed software using the
# environments default package manager

set -e

# Source generic bash functions
source $DOTFILES/share/lib/bash-functions.sh

case $(uname) in
  (Darwin)
    # Update homebrew (if installed) and upgrade packages
    if hash brew 2>/dev/null; then
      spininfo "Updating homebrew repo" "brew update > /dev/null 2>&1"
      echoinfo "Outdated packages" && brew outdated
      spininfo "Upgrading packages" "brew upgrade > /dev/null 2>&1"
      spininfo "Cleaning up" "brew cleanup > /dev/null 2>&1"
    fi
    if hash rbenv 2>/dev/null; then
      spininfo "Updating rbenv" "rbenv update > /dev/null 2>&1"
    fi
    # Update vim plugins
    spininfo "Updating vim plugins" "vim +BundleUpdate +qall > /dev/null 2>&1"
  ;;
  (Linux)
    if hash yum 2>/dev/null; then
      echoinfo 'Updating packages'
      sudo yum upgrade -y
    fi

    if hash aptitude 2>/dev/null; then
      echoinfo 'Updating packages'
      sudo aptitude upgrade -y
    fi

    # Update vim plugins
    echoinfo 'Updating vim plugins'
    vim +BundleUpdate +qall
  ;;
  (SunOS)
    # TODO: add opencsw and pkgutil
    echoinfo 'Updating packages'
    sudo pkgin update && sudo pkgin upgrade -y

    # Update vim plugins
    echoinfo 'Updating vim plugins'
    vim +BundleUpdate +qall
  ;;
esac

exit 0
