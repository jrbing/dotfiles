#!/usr/bin/env bash
# Usage:
# Summary:
# Help:

# Set the script to exit immediately on error
set -e

# Check if root
if [ $(whoami) != root ]; then
  echo " Must be root to use."
  exit
fi

usage(){
cat <<'EOT'
Call this script with...
EOT
exit 0;
}

# Exit if there are no arguments
[ $# -eq 0 ] && usage
set -- `getopt -n$0 -u -a --longoptions "help dogs: cats:" "hd:c:" "$@"`

# $# is the number of arguments
while [ $# -gt 0 ]
do
  case "$1" in
  -d|--dogs) dogs="$2"; shift;;
  -c|--cats) cats="$2"; shift;;
  -h|--help) usage;;
  --) shift;break;;
  *) break;;
  esac
  shift
done

cleanup_before_exit () {
  # this code is run before exit
  echo -e "Running cleanup code and exiting"
}
# trap catches the exit signal and runs the specified function
trap cleanup_before_exit EXIT

# OK now do stuff
echo "$cats and $dogs living together, mass hysteria!"

# Required program(s)
req_progs=(prog1 prog2)
for p in ${req_progs[@]}; do
  hash "$p" 2>&- || \
  { echo >&2 " Required program \"$p\" not installed."; exit 1; }
done

# Display usage if no parameters given
if [[ -z "$@" ]]; then
  echo " ${0##*/} <input> - description"
  exit
fi
